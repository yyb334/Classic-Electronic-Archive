<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Song Archive</title>
  <style>
    .tag-button {
      margin: 3px;
      padding: 5px 10px;
      cursor: pointer;
      border: 1px solid #aaa;
      border-radius: 4px;
      background-color: #eee;
    }
    .tag-button.active {
      background-color: #ccc;
    }
    #song-list li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

  <div id="tag-container"></div>
  <ul id="song-list"></ul>

  <script>
    async function fetchSongs() {
      const response = await fetch('songs.json');
      if (!response.ok) {
        throw new Error('Failed to load songs.json');
      }
      const songs = await response.json();
      return songs;
    }

    function createTagButton(tag, onClick) {
      const btn = document.createElement('button');
      btn.className = 'tag-button';
      btn.textContent = tag;
      btn.addEventListener('click', () => onClick(tag, btn));
      return btn;
    }

    async function loadTagsAndSongs() {
      const songs = await fetchSongs();

      // Collect all tags
      let allTags = [];
      songs.forEach(song => {
        allTags = allTags.concat(song.tags);
      });

      // Unique tags
      const uniqueTags = [...new Set(allTags)];

      // Filter out individual year-range tags like "1999-2000" or "1997-1998"
      // Pattern: 4 digits, dash, 4 digits, e.g., '1999-2000'
      const filteredTags = uniqueTags.filter(tag => {
        return !/^\d{4}-\d{4}$/.test(tag);
      });

      const tagContainer = document.getElementById('tag-container');
      tagContainer.innerHTML = '';

      let activeTag = null;

      function renderSongs(filteredSongs) {
        const songList = document.getElementById('song-list');
        songList.innerHTML = '';
        filteredSongs.forEach(song => {
          const li = document.createElement('li');
          li.textContent = `${song.title} â€“ ${song.artist}`;
          songList.appendChild(li);
        });
      }

      function onTagClick(tag, btn) {
        // Toggle active tag
        if (activeTag === tag) {
          activeTag = null;
          btn.classList.remove('active');
          renderSongs(songs); // Show all songs
        } else {
          activeTag = tag;
          // Remove active from all buttons
          [...tagContainer.children].forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          // Filter songs by tag
          const filteredSongs = songs.filter(song => song.tags.includes(tag));
          renderSongs(filteredSongs);
        }
      }

      // Create buttons for all filtered tags
      filteredTags.forEach(tag => {
        const btn = createTagButton(tag, onTagClick);
        tagContainer.appendChild(btn);
      });

      // Show all songs by default
      renderSongs(songs);
    }

    loadTagsAndSongs();
  </script>
</body>
</html>
